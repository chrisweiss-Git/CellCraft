<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>2D Layout — Diamond Precision Robot Cell</title>
<link rel="stylesheet" href="styles.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

<header>
  <div class="brand">
    <h1>Diamond Precision — Robot Cell Designer</h1>
    <span class="badge">MVP Prototype</span>
  </div>
  <nav>
    <a href="index.html">Overview</a>
    <a href="wizard.html">Cell Wizard</a>
    <a href="layout.html" class="active">2D Layout</a>
    <a href="simulator.html">3D Simulator</a>
  </nav>
</header>

<div class="container">
<h2>2D Layout Planner</h2>

<div class="panel">
  <div class="toolbar">
    <button class="button" onclick="autoPlace()">Auto-Place</button>
    <button class="button secondary" onclick="resetLayout()">Reset</button>
    <button class="button" onclick="saveAndOpen3D()">Save → 3D Simulator</button>
    <span class="badge">Area: <span id="areaLbl">12×16 ft</span></span>
  </div>

  <canvas id="layout" width="900" height="540"></canvas>
</div>

<table class="table" id="tbl"></table>
</div>

<script>
const canvas = document.getElementById('layout');
const ctx = canvas.getContext('2d');
const scale = 30;

const area = { w: 12, d: 16 };
const robotReachFt = 6;

const items = [
  { id:'robot', name:'Robot', w:3, d:3, x:3, y:8, color:'#22d3ee' },
  { id:'cnc', name:'CNC', w:6, d:4, x:8, y:8, color:'#60a5fa' },
  { id:'pallet', name:'Finished Pallet', w:2, d:2, x:4, y:12, color:'#10b981' },
  { id:'infeed', name:'Raw Infeed', w:2, d:2, x:2, y:12, color:'#a78bfa' },
  { id:'scrap', name:'Scrap Bin', w:2, d:2, x:10, y:12, color:'#ef4444' }
];

let dragging=null, offset={x:0,y:0};

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle='#334155';
  for(let x=0;x<=area.w*scale;x+=scale){
    for(let y=0;y<=area.d*scale;y+=scale){
      ctx.strokeRect(x,y,scale,scale);
    }
  }

  const robot = items.find(i=>i.id==='robot');
  ctx.beginPath();
  ctx.arc(robot.x*scale, robot.y*scale, robotReachFt*scale, 0, Math.PI*2);
  ctx.strokeStyle='#22d3ee55';
  ctx.lineWidth=8;
  ctx.stroke();

  items.forEach(it=>{
    ctx.fillStyle=it.color;
    ctx.fillRect(it.x*scale,it.y*scale,it.w*scale,it.d*scale);
    ctx.strokeStyle='#0f172a';
    ctx.strokeRect(it.x*scale,it.y*scale,it.w*scale,it.d*scale);
    ctx.fillStyle='#e5e7eb';
    ctx.fillText(it.name,it.x*scale+6,it.y*scale+14);
  });

  saveLayout();
}

function saveLayout(){
  localStorage.setItem('robotCellLayout',
    JSON.stringify({ area, items })
  );
}

function updateTable(){
  const tbl=document.getElementById('tbl');
  tbl.innerHTML='<tr><th>Item</th><th>X</th><th>Y</th></tr>'+
    items.map(i=>`<tr><td>${i.name}</td><td>${i.x.toFixed(1)}</td><td>${i.y.toFixed(1)}</td></tr>`).join('');
  document.getElementById('areaLbl').textContent=`${area.w}×${area.d} ft`;
}

canvas.addEventListener('mousedown',e=>{
  const r=canvas.getBoundingClientRect();
  const mx=e.clientX-r.left,my=e.clientY-r.top;
  items.forEach(it=>{
    if(mx>=it.x*scale && mx<= (it.x+it.w)*scale &&
       my>=it.y*scale && my<= (it.y+it.d)*scale){
      dragging=it;
      offset.x=mx-it.x*scale;
      offset.y=my-it.y*scale;
    }
  });
});

window.addEventListener('mouseup',()=>dragging=null);
window.addEventListener('mousemove',e=>{
  if(!dragging) return;
  const r=canvas.getBoundingClientRect();
  dragging.x=Math.max(0,Math.min(area.w-dragging.w,(e.clientX-r.left-offset.x)/scale));
  dragging.y=Math.max(0,Math.min(area.d-dragging.d,(e.clientY-r.top-offset.y)/scale));
  draw(); updateTable();
});

function autoPlace(){
  items[0].x=4; items[0].y=8;
  items[1].x=7; items[1].y=7;
  draw(); updateTable();
}

function resetLayout(){
  items.forEach(i=>{
    i.x=Math.random()*(area.w-i.w);
    i.y=Math.random()*(area.d-i.d);
  });
  draw(); updateTable();
}

function saveAndOpen3D(){
  saveLayout();
  window.location.href='simulator.html';
}

draw(); updateTable();
</script>
</body>
</html>
